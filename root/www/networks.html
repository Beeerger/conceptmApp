<!DOCTYPE html>
<html>
    <!-- //Header mit Metadaten-->
    <head> 
        <meta charset="utf-8">
        <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width">
        <title>Concept Map</title>

       <!-- //Download the necessary resources from unpkg  nicer comment-->
        <script
          type="text/javascript"
          src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"
        ></script>

        <!-- //create a new canvas -->
        <style type="text/css">

          #title{
            text-align: center;
            color: blueviolet;
          }

          #mynetwork {
            display: block;
            margin-left: auto;
            margin-right: auto;
            margin-bottom: 2.5em;
            width: 95%;
            height: 400px;
            border: 1px solid lightgray;
          }

          #button {
            text-align: center;
            font-size: 20px;
            margin-right: 0.1em;
          }

          #buttonContainer {
            text-align: center;
            margin-top: 1em;
            margin-bottom: 1em;
          }

          #textfield {
            text-align: center;
            margin-bottom: 1.0em;
          }

        </style>

    </head>

    <body style="background-color:rgb(67, 67, 208); height:100%;">
      
      <h2 id="title"> Network Container </h2>

      <!-- get the network created in the header -->
      <div id="mynetwork"></div>

      <!-- input text field for values -->
      <fieldset style="text-align: center;">
        <legend>Inputs</legend>
        
        <label for= "elementName"> Element name </label>
        <input type="text" id="elementName" placeholder="Name"/> <br>
        
        <label for= "fromNode"> Edge from </label>
        <input type="text" id="fromNode" placeholder="From"/> <br>
      
        <label for="toNode"> Edge to </label>
        <input type="text" id="toNode" placeholder="To"/> <br>

      </fieldset>

      <!-- Node buttons -->
      <div id="buttonContainer">
        <button id="button" onclick = createNode()> Create Node </button>
        <button id="button" onclick = removeNode()> Delete Node </button>
      </div>

      <!-- Edge buttons -->
      <div id="buttonContainer">
        <button id="button" onclick = createEdge()> Create Edge </button>
        <button id="button" onclick = removeEdge()> Delete Edge </button>
      </div>

      <!-- Import/Export buttons -->
      <!-- use string "student" to identify correct save and load positions -->
      <div id="buttonContainer">
        <button id="button" onclick = "LoadMap('teacher');"> Load Map </button>
        <button id="button" onclick = "SaveMap('teacher');"> Save Map </button>
      </div>

      <!-- Import/Export buttons -->
      <div id="buttonContainer">
        <button id="button" onclick = ImportMap()> Import Map </button>
        <button id="button" onclick = ExportMap()> Export Map </button>
      </div>

      <!-- Info Button, for debugging purposes -->
      <div id="buttonContainer">
        <button id="button" onclick = showInfo()> Info </button>
      </div>

      <div id="buttonContainer">
        <button type=“button”><a href="networks_student.html"> Student </a></button>
      </div>


      <script source = "jquery-3.6.1.min.js"></script>
      <script type='text/javascript' src = "vis_network.js">  // network implementation </script>
      <script type='text/javascript' src = "qrscanner.js">    // qr code implementation </script>


      <!-- the script creating the network starts here -->
      <script type="text/javascript">

        // create an array with nodes
        // nodes have positive unique ids (excluding 0)
        var nodes = new vis.DataSet([
          { id: 1, label: "saure Lösung", x: -354, y: 1 },
          { id: 2, label: "Oxonium-Ionen", x: -215, y: 147 },
          { id: 3, label: "Säure", x: -159, y: 55 },
          { id: 4, label: "Protonendonator", x: -187, y: -37 },
          { id: 5, label: "Säure-Base-Paar", x: -8, y: 144 },
          { id: 6, label: "Säure-Base-Reaktion", x: 14, y: -40},
          { id: 7, label: "Base", x: 153, y: 64},
          { id: 8, label: "Protonenakzeptor", x: 215, y: -65},
          { id: 9, label: "basische Lösung", x: 390, y: -13},
          { id: 10, label: "Hydroxid-Ionen", x: 256, y: 152},
        ]);
  
        // create an array with edges
        // edges have negative unique ids (excluding 0)
        var edges = new vis.DataSet([
          { id: -1, from: 1, to: 2, label: "enthält" },      // , arrows:'to,from' possible individually
          { id: -2, from: 3, to: 1, label: "bildet mit Wasser" },
          { id: -3, from: 3, to: 4, label: "ist definiert als" },
          { id: -4, from: 3, to: 5, label: "ist Teil eines" },
          { id: -5, from: 5, to: 6, label: "ist Teil der" },
          { id: -6, from: 7, to: 5, label: "ist Teil eines" },
          { id: -7, from: 7, to: 8, label: "ist definiert als" },
          { id: -8, from: 7, to: 9, label: "bildet mit Wasser" },
          { id: -9, from: 9, to: 10, label: "enthält" },
        ]);

        //two counters for the IDs to ensure unique IDs
        let nextNodeID = 11
        let nextEdgeID = -10

        var options = {
          manipulation: {
            enabled: true,        // add an edit button
            addNode: function(nodeData,callback) {
              nodeData.label = prompt("Please enter node name", "");
              callback(nodeData);
            },
            editNode: function(nodeData,callback) {
              nodeData.label = prompt("Please enter node name", ""); 
              callback(nodeData); 
            },
            addEdge: function(edgeData,callback) {
              if (edgeData.from === edgeData.to) {
                var r = confirm("Do you want to connect the node to itself?");
                if (r === true) {
                  edgeData.label = prompt("Please enter edge name", "");
                  callback(edgeData);
                }
              }
              else {
                edgeData.label = prompt("Please enter edge name", "");
                callback(edgeData);
              }
            },
            editEdge: function(nodeData,callback) {
              nodeData.label = prompt("Please enter edge name", ""); 
              callback(nodeData); 
            },
          },
          layout: {
            hierarchical: false,  // this makes two edges on same way visible, but lessens visibility
          },
          edges: {                // options set for all edges
            arrows: 'to',         // arrows on the "to" end of the edge
            physics: false,
            smooth: true,
          },
          nodes: {
            shape: "box",
            fixed: false,
            physics: false,
          }
        };

        var container = document.getElementById("mynetwork");

        var data = {
          nodes: nodes,
          edges: edges,
        };


        // build the network together
        var network = new vis.Network(container, data, options);

        // save the map to local storage
        SaveMap("teacher")

      </script>


      <!-- currently the script part with the functions, this is going to be outsourced to vis_network.js -->
      <script>


          // function to extract parameters for new node and call vis_network functions
          function createNode() {

            var name = getName()
            try {
              AddNode(name)
            }
            catch(err) {
              alert("Error creating the Node")
            }
           }

          // function to extract parameters for the node to delete and call vis_network functions
          function removeNode(){
            try {
              var name = getName()
              DeleteNode(name)
            }
            catch(err) {
              alert("Error removing the Node")
            }
            
          }

          // function to extract parameters for new edge and call vis_network functions
          function createEdge(){
            try {
              var name = getName()
              var [fromNode, toNode] = getConnection()
              AddEdge(name, fromNode, toNode)
            }
            catch(err) {
              alert("Error creating the Edge")
            }
            
          }

          // function to extract parameters for the edge to delete and call vis_network functions
          function removeEdge(){
            try {
              var name = getName()
              var [fromNode, toNode] = getConnection()
              DeleteEdge(name, fromNode, toNode)
            }
            catch(err) {
              alert("Error deleting the Edge")
            }
            
          }

          // function to return the name out of the text input
          function getName(){
            var name = document.getElementById("elementName").value;
            return name
          }

          // function to return the connecting nodes for the edge
          function getConnection(){
            var fromNode = document.getElementById("fromNode").value;
            var toNode = document.getElementById("toNode").value;
            return [fromNode, toNode]
          }

          // function logging info for debugging purposes
          function showInfo(){
            console.log("Next Node ID: ", nextNodeID)
            console.log("Next Edge ID: ", nextEdgeID)
            // console.log(data.nodes)
            // console.log(data.edges)
          }

      </script>


      <!-- black magic, very important, such danger -->
      <script type="text/javascript" src="cordova.js"></script>

    </body>
</html>
